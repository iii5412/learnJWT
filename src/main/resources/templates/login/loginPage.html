<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/login/loginPage.css}"/>
<script th:type="module" th:src="@{/js/util.js}"></script>
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<div class="login-page">
    <div class="header">
        <h1>로그인</h1>
    </div>
    <div class="content">
        <div class="input-container">
            <label for="loginId">아이디</label>
            <input type="text" id="loginId" name="loginId">
        </div>
        <div class="input-container">
            <label for="loginPw">비밀번호</label>
            <input type="password" id="loginPw" name="loginPw">
        </div>
        <input type="button" id="loginBtn" value="로그인" />
        <input type="button" id="signUpBtn" value="회원가입" />
    </div>
</div>
<script th:type="module">
    import {qs} from "/js/util.js";
    import {login, goSignupPage} from "/js/apis/auth/auth.js";
    import {FetchError} from "/js/error/fetchError.js";
    const loginBtn = qs(document, '#loginBtn');
    const signUpBtn = qs(document, '#signUpBtn');

    loginBtn.addEventListener('click', () => {
        const loginId = qs(document, '#loginId').value;
        const loginPw = qs(document, '#loginPw').value;

        login(loginId, loginPw)
            .then(async response => {
                if (response.ok) {
                    location.href = "/";
                } else {
                    if (response.status === 400) {
                        const responseJson = await response.json();
                        throw new FetchError(responseJson);
                    }
                }
            })
            .catch(e => {
                if(e instanceof FetchError)
                    alert(e.serverMessage);
                else
                    alert('오류가 발생하였습니다.');
            });
    });

    signUpBtn.addEventListener('click', goSignupPage);

</script>
</html>
