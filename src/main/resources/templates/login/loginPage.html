<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/login/loginPage.css}"/>
<script th:type="module" th:src="@{/js/util.js}"></script>
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<div class="login-page">
    <div class="header">
        <h1>로그인</h1>
    </div>
    <div class="content">
        <div class="input-container">
            <label for="username">아이디</label>
            <input type="text" id="username" name="username">
        </div>
        <div class="input-container">
            <label for="password">비밀번호</label>
            <input type="password" id="password" name="password">
        </div>
        <input type="button" id="loginBtn" value="로그인" />
        <input type="button" id="signUpBtn" value="회원가입" />
    </div>
</div>
<script th:type="module">
    import {qs} from "/js/util.js";
    import {login, goSignupPage} from "/js/apis/auth/auth.js";
    import FetchError from "/js/apis/error/fetchError.js";
    const loginBtn = qs(document, '#loginBtn');
    const signUpBtn = qs(document, '#signUpBtn');

    loginBtn.addEventListener('click', () => {
        const username = qs(document, '#username').value;
        const password = qs(document, '#password').value;

        login(username, password)
            .then(async response => {
                if (response.ok) {
                    location.href = "/";
                } else {
                    if (response.status === 400) {
                        const responseJson = await response.json();
                        throw new FetchError(response.status, responseJson.message);
                    }
                }
            })
            .catch(e => {
                if(e instanceof FetchError)
                    alert(e.serverMessage);
                else
                    alert('오류가 발생하였습니다.');
            });
    });

    signUpBtn.addEventListener('click', goSignupPage);

</script>
</html>
